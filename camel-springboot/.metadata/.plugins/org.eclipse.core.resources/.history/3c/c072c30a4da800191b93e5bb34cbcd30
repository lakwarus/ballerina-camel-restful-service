package com.lakwarus.sample.pojo;

//import java.util.concurrent.atomic.AtomicLong;

import org.apache.camel.Exchange;
import com.fasterxml.jackson.core.JsonParseException;
import org.apache.camel.Processor;
import org.apache.camel.builder.RouteBuilder;
import org.apache.camel.model.rest.RestBindingMode;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.stereotype.Component;

@SpringBootApplication
public class SpringbootCamelRestdslApplication {

	public static void main(String[] args) {
		SpringApplication.run(SpringbootCamelRestdslApplication.class, args);
	}

	@Component
	class OrderRoute extends RouteBuilder {

		@Override
		public void configure() throws Exception {
							
			restConfiguration().component("servlet").bindingMode(RestBindingMode.json);
			
			rest("/ordermgt").consumes("application/json").post("/order").type(Order.class);

			rest("/ordermgt").get("/order/{orderId}")
					.to("direct:getOrder");

			
			onException(Exception.class).handled(true).process(new Processor() {

                public void process(Exchange exchange) throws Exception {
                    System.out.println("handling ex");
                    Exception ex = (Exception) exchange.getProperty(Exchange.EXCEPTION_CAUGHT);
                    log.info(" Exception : "+ex.getMessage());
                    exchange.getIn().setBody(" Exception Occured :"+ex.getMessage());
                }
            });
			
			//rest("/ordermgt").produces("application/text").post("/order").route()
		//		.choice()
		//			.when().jsonpath("Order",true)
		//				.to("direct:addOrder");
	
		//			.otherwise()
		//				.log("Invaliad Json recived!")
		//				.transform().simple("In-valiad Order Json!").endRest();
			
			
			from("direct:getOrder").process(new Processor() {

				@Override
				public void process(Exchange exchange) throws Exception {
					
					long orderId =  exchange.getIn().getHeader("orderId",long.class);
					
					Order order = exchange.getIn().getBody(Order.class);
					System.out.println(" ********* Order ID " + order.getDescription(orderId));
					

				}
			});
		}

	}
}
